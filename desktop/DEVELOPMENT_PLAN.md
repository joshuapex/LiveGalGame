# LiveGalGame Desktop 开发计划

## 开发原则
- **MVP优先**：从最简可行产品开始，逐步迭代
- **渐进式开发**：每一步完成后立即测试运行，确保无报错
- **Mock先行**：LLM/语音识别等接口先使用Mock数据
- **参考官方文档**：遇到不确定的用法时，查阅 [Electron官方文档](https://www.electronjs.org/zh/docs/latest/)

## 技术栈
- **框架**：Electron 33+ (最新稳定版)
- **包管理器**：pnpm 8+
- **UI框架**：原生HTML + Tailwind CSS
- **前端**：Vanilla JavaScript (无框架，降低复杂度)
- **构建工具**：electron-builder

## 核心模块
1. **主进程** (main.js) - Electron应用入口
2. **主窗口** - 对话管理和配置界面
3. **HUD浮窗** - 实时辅助界面
4. **音频采集** - 麦克风/系统音频
5. **Mock LLM服务** - 模拟AI建议
6. **数据存储** - 本地JSON存储

---

## MVP 分阶段开发计划

### 阶段 0: 基础项目搭建
**目标**：创建可运行的Electron项目骨架

**步骤 0.1**: 初始化项目
- 创建 `package.json`
- 配置 pnpm + Electron 33
- 添加基础脚本: `dev`, `build`
- 验证: `pnpm dev` 能启动空窗口

**【确认点】** 请验证：
1. 项目初始化成功，无安装错误
2. `pnpm dev` 能启动Electron窗口
3. 确认后我将进入下一步

**步骤 0.2**: 基础文件结构
- `main.js` - 主进程入口
- `preload.js` - 预加载脚本（安全上下文）
- `renderer/` - 渲染进程代码
- 验证: 主窗口正常显示

**【确认点】** 请验证：
1. 文件结构创建完成
2. `pnpm dev` 能正常显示主窗口
3. 确认后我将进入下一步

**步骤 0.3**: 开发环境配置
- 热重载配置
- 开发者工具集成
- 日志系统
- 验证: 修改代码自动重载

**【确认点】** 请验证：
1. 热重载工作正常
2. 开发者工具可用
3. 确认后阶段0完成，进入下一阶段

---

### 阶段 1: 主窗口UI框架 (Day 1)
**目标**：实现主窗口的基础UI，参考原型图

**步骤 1.1**: 窗口配置
- 设置窗口尺寸 (1200x800)
- 配置标题栏和图标
- 添加快捷键 (Ctrl+R 刷新, Ctrl+Shift+I 开发者工具)
- 验证: 窗口正常显示，快捷键有效

**【确认点】** 请验证：
1. 窗口尺寸设置正确
2. 快捷键功能正常
3. 确认后我将进入下一步

**步骤 1.2**: 基础布局
- 左侧导航栏（对话列表）
- 中间主内容区（对话详情）
- 右侧AI分析面板
- 使用Tailwind CSS实现样式
- 验证: 三栏布局正常显示

**【确认点】** 请验证：
1. 三栏布局正确显示
2. Tailwind CSS样式生效
3. 确认后我将进入下一步

**步骤 1.3**: 对话列表组件
- 硬编码几个示例对话
- 头像 + 名称 + 最后消息
- 选中状态高亮
- 验证: 能切换不同对话

**步骤 1.4**: 对话详情组件
- 消息气泡（对方/自己）
- 时间戳
- AI高亮显示
- 验证: 消息正确显示

**步骤 1.5**: AI分析面板
- AI洞察区域
- 对话分类标签
- 情感分析
- 验证: 静态数据正确显示

---

### 阶段 2: HUD浮窗基础 (Day 2)
**目标**：创建可浮动的HUD窗口

**步骤 2.1**: HUD窗口创建
- 创建无边框、透明窗口
- 设置初始位置 (右下角)
- 配置置顶/穿透模式
- 验证: HUD窗口能显示

**步骤 2.2**: HUD UI基础
- 双通道转录区域（对方/自己）
- 最小化/收起按钮
- 简单样式（半透明背景）
- 验证: UI元素正常显示

**步骤 2.3**: 主窗口与HUD通信
- IPC通信机制
- 主窗口按钮"开始对话" → 显示HUD
- HUD关闭 → 返回主窗口
- 验证: 双向通信正常

**步骤 2.4**: HUD交互
- 拖拽移动
- 鼠标穿透切换
- 自动收起/展开
- 验证: 交互功能正常

---

### 阶段 3: 音频采集与权限 (Day 3)
**目标**：实现麦克风权限请求和基础音频流

**步骤 3.1**: 权限请求系统
- 首次启动权限检测
- 麦克风权限请求UI
- 权限状态存储
- 验证: 能正确请求权限

**步骤 3.2**: 音频测试组件
- 连接测试按钮
- 音频波形可视化
- 测试录音/播放
- 验证: 能看到音频波形

**步骤 3.3**: 用户麦克风采集
- 使用 Web Audio API
- 获取麦克风音频流
- 音频数据处理
- 验证: 能采集麦克风音频

**步骤 3.4**: 音频状态管理
- 录音状态（开始/停止）
- 音量检测
- 错误处理
- 验证: 状态切换正常

---

### 阶段 4: Mock语音识别和LLM集成 (Day 4-5)
**目标**：实现Mock的AI建议系统

**步骤 4.1**: Mock语音识别服务
- 创建 `mock-asr.js`
- 模拟语音转文字（随机延迟2-3秒）
- 模拟对方音频转文字
- 验证: 能返回Mock文本

**步骤 4.2**: Mock LLM服务
- 创建 `mock-llm.js`
- 模拟建议卡生成（基于关键词）
- 模拟情感分析
- 验证: 能返回Mock建议

**步骤 4.3**: 建议卡UI
- 建议卡片组件
- 标题 + 一句话 + 标签
- 好感度变化预测
- 验证: 建议卡正常显示

**步骤 4.4**: HUD集成AI建议
- 监听对话内容
- 触发建议生成
- 在HUD显示建议卡
- 验证: 建议能实时显示

**步骤 4.5**: 建议交互
- 点击选择建议
- 编辑框弹出
- 一键复制
- 验证: 交互功能正常

---

### 阶段 5: 即时反馈系统 (Day 6)
**目标**：实现好感度动画和反馈

**步骤 5.1**: 好感度状态
- 创建好感度数据模型
- 初始值50
- 存储和更新逻辑
- 验证: 状态管理正常

**步骤 5.2**: 好感度动画
- 数字变化动画（50→70）
- "+20"上浮效果
- 颜色变化（红色/绿色）
- 验证: 动画流畅

**步骤 5.3**: 反馈解释
- 轻量解释文本
- 显示3秒后自动消失
- 位置在HUD底部
- 验证: 显示和消失正常

**步骤 5.4**: 触发机制
- 监听用户发送动作
- 计算好感度变化
- 触发动画和解释
- 验证: 完整流程正常

---

### 阶段 6: 数据模型和存储 (Day 7)
**目标**：实现本地数据存储

**步骤 6.1**: 对话数据模型
- 人物档案（昵称、关系标签、备注）
- 对话记录（时间、内容、发送者）
- AI分析结果
- 验证: 数据结构合理

**步骤 6.2**: 本地存储实现
- 使用 `electron-store`
- 对话列表持久化
- 配置持久化
- 验证: 重启后数据保留

**步骤 6.3**: CRUD操作
- 创建新对话
- 编辑对话信息
- 删除对话
- 保存对话记录
- 验证: 所有操作正常

**步骤 6.4**: 数据导入/导出
- 导出对话为JSON
- 从文件导入
- 验证: 导入导出正常

---

### 阶段 7: 复盘分析功能 (Day 8)
**目标**：实现对话复盘和报告

**步骤 7.1**: 复盘页面
- 创建复盘路由/页面
- 人物详情展示
- 对话统计（次数、时间、好感度）
- 验证: 页面正常显示

**步骤 7.2**: 可视化组件
- 好感度变化曲线图
- 关键事件时间轴
- 使用Chart.js
- 验证: 图表正常显示

**步骤 7.3**: AI复盘报告
- Mock复盘分析文本
- "做得好"区域
- "可改进"区域
- "下次建议"区域
- 验证: 报告内容显示

**步骤 7.4**: 报告导出
- 导出为Markdown
- 复制到剪贴板
- 验证: 导出功能正常

---

### 阶段 8: 设置和配置 (Day 9)
**目标**：实现设置页面

**步骤 8.1**: 设置页面UI
- 模型选择（结果导向文案）
- API Key输入
- Endpoint配置
- 验证: UI正常显示

**步骤 8.2**: 连接测试
- 测试连接按钮
- 延迟/速率显示
- 成功/失败反馈
- 验证: 测试功能正常

**步骤 8.3**: 多配置管理
- 添加多个配置
- 设置默认配置
- 星标标记
- 验证: 配置切换正常

**步骤 8.4**: 代理配置
- 代理设置UI
- `dl1`命令集成（可选）
- 验证: 配置保存正常

---

### 阶段 9: 高级音频功能 (Day 10)
**目标**：系统音频采集（平台相关）

**步骤 9.1**: Windows系统音频
- 使用 `desktopCapturer` + WASAPI
- 获取系统音频流
- 测试和验证
- 验证: Windows上能捕获系统音频

**步骤 9.2**: macOS系统音频
- 屏幕录制权限请求
- 音频采集实现
- 虚拟声卡方案说明
- 验证: macOS上能捕获系统音频

**步骤 9.3**: 音频混合
- 用户音频 + 系统音频
- 分别处理和识别
- 验证: 双通道音频正常

---

### 阶段 10: 完善和测试 (Day 11-12)
**目标**：完善细节，全面测试

**步骤 10.1**: 权限和安全
- 完整的权限检查流程
- 隐私说明文案
- 安全最佳实践
- 验证: 权限流程完善

**步骤 10.2**: 错误处理
- 网络错误处理
- API调用失败降级
- 用户友好错误提示
- 验证: 错误场景覆盖

**步骤 10.3**: 性能优化
- 内存泄漏检查
- 启动速度优化
- 响应速度优化
- 验证: 性能良好

**步骤 10.4**: 打包和分发
- electron-builder配置
- Windows打包 (build:win)
- macOS打包 (build:mac)
- 验证: 能生成安装包

**步骤 10.5**: 完整流程测试
- Onboarding流程
- 实时对话流程
- 复盘分析流程
- 验证: 所有流程正常

---

## 开发流程规范

### 关键流程要求
⚠️ **重要规定**：每个开发步骤完成后，必须立即编译测试，确认无报错且功能正常后，**需要得到用户确认**才能进行下一步。

### 测试验证清单
每个步骤完成后，必须进行以下验证：
- [ ] 代码无语法错误，能正常编译
- [ ] 应用能正常启动，不闪退
- [ ] 新增功能按预期工作
- [ ] 无控制台报错或警告
- [ ] 原有功能不受影响
- [ ] **用户确认通过** ✅

### 代码规范
- 使用ES6+语法
- 语义化变量命名
- 添加必要注释
- 遵循Electron安全最佳实践

### 提交规范
```
feat: 添加新功能
fix: 修复bug
docs: 文档更新
style: 代码格式
refactor: 重构
perf: 性能优化
test: 测试相关
chore: 构建/工具
```

### 确认点标记
在开发计划中，每个步骤末尾都有明确的确认点，例如：
**【确认点】** 请验证此步骤已完成且测试通过，确认后我将继续下一步。

---

## 参考资料
- [Electron官方文档](https://www.electronjs.org/zh/docs/latest/)
- 产品原型图: `/desktop/spec/images/code.html`
- 技术文档: `/desktop/spec/`
- 参考Demo: `/minimal-repro/`

---

## 风险和对策

| 风险 | 对策 |
|------|------|
| 音频采集跨平台兼容性 | 分平台实现，详细测试 |
| 权限请求被拒 | 友好提示，提供手动设置指南 |
| LLM响应延迟高 | Mock数据先行，后续优化流式处理 |
| HUD窗口管理复杂 | 逐步添加功能，确保稳定性 |
| 性能问题 | 定期性能测试，及时优化 |

---

## 下一步
完成本计划后，可以根据用户反馈进行：
1. 接入真实的ASR和LLM服务
2. 添加更多可视化图表
3. 优化UI/UX细节
4. 添加云同步功能
5. 支持更多平台特性
